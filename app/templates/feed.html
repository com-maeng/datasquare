<!DOCTYPE html>
<html>

<head>
    <title>Issue feed</title>
    <link rel="stylesheet" href="/static/css/feed.css">
</head>

<body>
    <div class="container">
        <div class="left">
            <input type="text" id="search-input" placeholder="Search..">
            <button onclick="search()">Search</button>
            <div id="recent-searches">
                <ul id="recent-searches">
                    <!-- 최근 검색어 목록 -->
                </ul>
            </div>
            <div id="teams">
                <ul id="teams">
                    {% for team in teams %}
                    <li><a href="/feed/search?keyword=&team={{ team.team_name }}">{{ team.team_name }}</a></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="right">
            <div class="controls">
                <button onclick="filterMyIssues()">My Issues</button>
                <button onclick="sortIssues('newest')">Newest</button>
                <button onclick="sortIssues('oldest')">Oldest</button>
            </div>
            <div class="issues">
                {% for issue in issues %}
                <div class="issue-card">
                    <img src="data:image;base64,{{ issue.profile_pic | safe }}" alt="Profile Picture">
                    <h3>{{ issue.title }}</h3>
                    <p>{{ issue.content }}</p>
                    <p>{{ issue.author_name }}</p>
                    <p>{{ issue.team }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <script>

        function search() {
            const searchInput = document.getElementById('search-input').value.trim();

            if (searchInput) {
                // 검색어를 sessionStorage에 저장
                let recentSearches = JSON.parse(sessionStorage.getItem('recentSearches')) || [];

                // 중복 검색어 제거
                if (!recentSearches.includes(searchInput)) {
                    recentSearches.unshift(searchInput); // 최근 검색어를 맨 앞에 추가
                    if (recentSearches.length > 10) {
                        recentSearches.pop(); // 최근 검색어는 최대 10개까지만 유지
                    }
                    sessionStorage.setItem('recentSearches', JSON.stringify(recentSearches));
                }

                window.location.href = '/feed/search?team=&keyword=' + searchInput;
            }
        }

        function displayRecentSearches() {
            const recentSearches = JSON.parse(sessionStorage.getItem('recentSearches')) || [];
            const recentSearchesContainer = document.getElementById('recent-searches');

            recentSearchesContainer.innerHTML = '';
            recentSearches.forEach(search => {
                const searchItem = document.createElement('li');
                searchItem.setAttribute("style", "cursor:pointer;")
                searchItem.textContent = search;
                searchItem.onclick = function () {
                    window.location.href = '/feed/search?team=&keyword=' + search;
                };
                recentSearchesContainer.appendChild(searchItem);
            });
        }

        function filterMyIssues() {
            window.location.href = '/feed/my_issues';
        }

        function sortIssues(order) {
            // Implement sorting functionality
        }

        window.onload = function () {
            displayRecentSearches();
        };

    </script>
</body>

</html>